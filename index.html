<!DOCTYPE html>
<html>
<head>
	<title>Wendy's MomentFeed Code Test</title>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js" type='text/javascript'></script>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular.min.js"></script>
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">

	<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">

	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
	<style>
		.blocks{
			width: 500px;
			border: 2px solid blue;
			/*float: left;*/
			margin: 15px auto;
		}
		.instAuthHide{
			color: gray;
		}
	</style>
</head>

<body ng-app='codeTestWendyApp' ng-controller='codeTestWendyController'>
<!-- http://wendygwo.github.io/codeTestWendy/#access_token=261156197.7f7b1d5.9710e2fa84914f08b307504bbf0743cb -->

	<!-- This is the link the user clicks to authorize this app to use Instagram -->
	<div class='instAuth' ng-hide='tokenAvailable()'>
		<h3 class='text-center'>To begin, click the button below to authorize this app to access your Instagram account</h1>
		<div class='row'>
			<div class='col-md-4 col-md-offset-4'>
				<a href='https://instagram.com/oauth/authorize/?client_id=7f7b1d50ce8f4ca28308d7322078d5d0&redirect_uri=http://wendygwo.github.io/codeTestWendy/&response_type=token' class='btn btn-primary center-block'>Click to authorize this app with Instagram</a>
			</div>
		</div>
	</div>
	<br>

	<!-- This button only shows up once you've clicked to authorize the app to use Instagram -->
	<div ng-show='tokenAvailable()'>
		<div class = 'row'>
			<div class='col-md-4 col-md-offset-4'>
				<input type='button' value='Click here to fill with pictures from your feed' id='mainButton' class='btn btn-default'>
			</div>
		</div>
		<div class='row'>
			<h3 class='text-center'>Pictures from your feed</h3>
			<div class='col-md-8 col-md-offset-1'>
				<div class="popular">
				</div>
			</div>
		</div>
	</div>

	<script>
		// $('instAuth').addClass('instAuthHide');

		angular.module('codeTestWendyApp', [])

		.controller('codeTestWendyController', function($scope){
			var docUrl
			var token_index
			$scope.tokenAvailable = function(){
				docUrl = document.URL;
				console.log('The URL in tokenAvailable() is: ' + docUrl);
				token_index = docUrl.indexOf('access_token=');
				console.log('access_token_index_tokenAvailable=' + token_index);
				if (token_index == -1){
					return false;
				} else {
					return true;
				}
			};
			$scope.getToken = function(){
				docUrl = document.URL;
				console.log('The URL in getToken() is: ' + docUrl);
				// Find index of access token string 
				token_index = docUrl.indexOf('access_token=');
				console.log('access_token_index=' + token_index);
				// if (token_index == -1){
				// 	console.log('No access token found');
				// 	return 'No token available. Please authorize this page to use Instagram.'
				// } else {
					var access_token = docUrl.slice(token_index+13, docUrl.length);
					console.log('The access token is: ' + access_token);
					return access_token
				// }
			};
			$('#mainButton').click(function(){
				console.log('Button clicked');

				myToken=$scope.getToken();
				console.log('myToken = '+myToken);

					$.ajax({
			      type: "GET",
			      dataType: "jsonp",
			      cache: false,
			      url: "https://api.instagram.com/v1/users/self/feed?access_token="+myToken,
			      success: function(data) {
			        // placing the images on the page
			        for (var i = 0; i < 6; i++) {
			          $(".popular").append("<div class='blocks'><a target='_blank' href='" + data.data[i].link + "'><img src='" + data.data[i].images.standard_resolution.url + "'></img></a></div>");
			    		}
			      }
			    });
			})
		});
	</script>

</body>
</html>