<!DOCTYPE html>
<html>
<head>
	<title>Wendy's MomentFeed Code Test</title>
	<!-- Include jQuery -->
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js" type='text/javascript'></script>
	<!-- Include Angular -->
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular.min.js"></script>
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
	<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">
	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
	<!-- Styling -->
	<style>
		.blocks{
			width: 32%;
			border: 2px solid gray;
			border-radius: 30px;
			float: left;
			margin: 2px;
		}
		.images{
			width: 100%;
			border-radius: 30px;
		}
	</style>
</head>

<body ng-app='codeTestWendyApp' ng-controller='codeTestWendyController'>
	<h1 class='text-center'>Welcome to Wendy's code test!</h1>
	<!-- This part shows up when the user first goes to the page and no auth token is available yet-->
	<div class='instAuth' ng-hide='tokenAvailable()'>
		<h3 class='text-center'>To begin: click the button below to authorize this app to access your Instagram account</h3>
		<div class='row'>
			<div class='col-md-4 col-md-offset-4'>
				<!-- This is the link the user clicks to authorize this app to use Instagram -->
				<a href='https://instagram.com/oauth/authorize/?client_id=7f7b1d50ce8f4ca28308d7322078d5d0&redirect_uri=http://wendygwo.github.io/codeTestWendy/&response_type=token' class='btn btn-info center-block'>Click to authorize this app with Instagram</a>
			</div>
		</div>
	</div>
	<br>

	<!-- This button only shows up once you've clicked to authorize the app to use Instagram -->

<!-- 	<div ng-show='tokenAvailable()'>
		<div class = 'row'>
			<div class='col-md-4 col-md-offset-4'>
				<input type='button' value='Click here to see the 30 most recent pictures posted to your feed' id='mainButton' class='btn btn-info center-block'>
			</div>
		</div>
		<br />
		<div class='row bg-info'> -->
			<!-- Pictures get populated here -->
<!-- 			<div class='popular col-md-8 col-md-offset-2 col-sm-10 col-sm-offset-1'>
			</div>
		</div>
	</div> -->


	<div ng-show='tokenAvailable()'>
		<div class = 'row'>
			<div class='col-md-4 col-md-offset-4'>
				<input type='button' value='Click to see most recent photos in to your feed' class='btn btn-info center-block' ng-click='myData()'>
			</div>
		</div>
		<br />
		<div class='row'>
			<div class='col-md-8 col-md-offset-2'>
				<!-- Images are populated here, with the ng-repeat -->
				<div ng-repeat='currentdata in apiData track by $index' class='blocks'>
					<a target='_blank' href="{{currentdata.link}}">
						<img src="{{currentdata.images.standard_resolution.url}}" class='images'>
						</img>
					</a>
				</div>
			</div>
		</div>
	</div>

	<script>
		angular.module('codeTestWendyApp', [])

		.controller('codeTestWendyController', function($scope, $http){
			var docUrl
			var token_index

			// Check to see if token available
			$scope.tokenAvailable = function(){
				docUrl = document.URL;
				token_index = docUrl.indexOf('access_token=');
				if (token_index == -1){
					return false;
				} else {
					return true;
				}
			};

			// Get the token
			$scope.getToken = function(){
				// Get URL of current page
				docUrl = document.URL;
				// Find index of access token string 
				token_index = docUrl.indexOf('access_token=');
				var access_token = docUrl.slice(token_index+13, docUrl.length);
				console.log('The access token is: ' + access_token);
				return access_token
			};
			$scope.myData=function(){
				console.log('Ng-click button clicked');
				myToken=$scope.getToken();
				var url = 'https://api.instagram.com/v1/users/self/feed?access_token='+myToken+'&callback=JSON_CALLBACK';
				var responsePromise = $http.jsonp( url,
															             {  params : {
															                   count : "30"
															                }
															              }
															            );
				responsePromise.success(function(data) {
			    // Grab the data returned from call
		    	console.log('Went into Angular success function');
		    	$scope.apiData=data.data;
	    		console.log($scope.apiData);
				});

			};
			// This runs when the main button is clicked
		// 	$('#mainButton').click(function(){
		// 		console.log('Button clicked');

		// 		myToken=$scope.getToken();
		// 		console.log('myToken = '+myToken);

		// 			$.ajax({
		// 	      type: "GET",
		// 	      dataType: "jsonp",
		// 	      cache: false,
		// 	      url: "https://api.instagram.com/v1/users/self/feed?access_token="+myToken+"&count=30",
		// 	      success: function(data) {
		// 	        // placing the images on the page
		// 	        for (var i = 0; i < 30; i++) {
		// 	          $(".popular").append("<div class='blocks'><a target='_blank' href='" + data.data[i].link + "'><img src='" + data.data[i].images.standard_resolution.url + "' class='images'></img></a></div>");
		// 	    		}
		// 	    		$scope.apiData=data.data;
		// 	    		console.log($scope.apiData);
		// 	      }
		// 	    });
		// 	})
		// });
	</script>

</body>
</html>